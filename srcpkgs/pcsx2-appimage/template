# Template file for 'pcsx2-appimage'
pkgname=pcsx2-appimage
archs="x86_64"
version=2.5.117
revision=1
create_wrksrc=yes
hostmakedepends="p7zip desktop-file-utils"
short_desc="Sony PlayStation 2 emulator"
maintainer="Tiago Carvalho <t1ago_@outlook.com>"
license="GPL-3.0-or-later, GPL-2.0-or-later, LGPL-2.1-or-later, LGPL-3.0-or-later"
homepage="https://pcsx2.net"
_appimg="pcsx2-v${version}-linux-appimage-x64-Qt.AppImage"
distfiles="https://github.com/PCSX2/pcsx2/releases/download/v${version}/${_appimg}"
checksum=7f948281d1f0e9a1bff8618656e53fa9a8c7073df8a2065f344965ae1da8f93d
_install=/opt/pcsx2
noshlibprovides=yes
noverifyrdeps=yes
nostrip=yes
nopie=yes

do_extract() {
	7z x ${XBPS_SRCDISTDIR}/pcsx2-appimage-${version}/${_appimg}
	chmod +x usr/bin/pcsx2-qt
}

do_install() {
	mkdir -p ${DESTDIR}/${_install}
	mkdir -p ${DESTDIR}/usr/share
	cp -r usr ${DESTDIR}/${_install}/
	mv \
		${DESTDIR}/${_install}/usr/share/icons \
		${DESTDIR}/${_install}/usr/share/applications \
		${DESTDIR}/usr/share/
	desktop-file-edit \
		--set-key Exec \
		--set-value ${_install}/usr/bin/pcsx2-qt \
		${DESTDIR}/usr/share/applications/net.pcsx2.PCSX2.desktop
}
